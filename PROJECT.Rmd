---
title: "DATA PROJECT"
author: "Angelica Gamboa and Gwendolyn Espinoza"
date: "2025-03-28"
output:
  slidy_presentation: default
  ioslides_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# INTRODUCTION

- The data was gathered from:
  - **National Center for Health Statistics (NCHS)** – *Leading Causes of Death in the U.S.*
  - **City of Chicago** – *Reported crime incidents*
- The **NCHS dataset** includes:
  - Mortality statistics across various U.S. states over multiple years
  - *Excludes murder* from the listed causes of death
- To ensure victim privacy:
  - Incident locations are provided at the **block level**, not exact addresses

---


# QUESTIONS
1. What are the leading causes of death since 2001?
2. Which state had the most amount of deaths in the US?
3. What was the leading cause of death in California?
4. How has the cause of heart disease deaths changed over time?
5. How has the cause of cancer deaths changed over time?
6. We know the adjusted death rate for the data, but what does the rate look like when we subtract "all causes'?
7. What is the death rate by cause and state?
8. What is the age-adjusted death rate for heart disease?


```{r echo = FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(dplyr)
data <- read.csv("NCHS_-_Leading_Causes_of_Death__United_States (1).csv")
```

---

# Variables in the dataset:
  - Year: `Year in which the incident took place.`
  - X113 cause name: `The full, official name of the cause of death classified by the NCHS.`
  - Cause name: `A broader label for the cause of death.`
  - State: `The U.S. state where the data was collected.`
  - Deaths: `The total number of deaths reported for a specific cause of death.`
  - Age-adjusted death rate: `The death rate per 100,000 people, adjusted per age group for fair comparison.`

---

## **Leading Causes of Death Since 2001**

```{r echo = FALSE}
# Filtering the data and removing "United States" from the column named 'States'
top_causes <- data %>%
  filter(Cause.Name != "All causes", State != "United States") %>% 
  group_by(Cause.Name) %>%
  summarise(total_deaths = sum(Deaths)) %>%
  arrange(desc(total_deaths))
  
# Plotting causes of death
ggplot(top_causes, aes(x = total_deaths, y = reorder(Cause.Name, total_deaths))) +
  geom_col(fill = 'purple3') +
  labs(title = 'Top 10 Causes of Death in the U.S. Since 2001',
       x = 'Total Deaths',
       y = 'Cause of Death')
```

CLRD stands for Chronic Lower Respiratory Diseases.

---

## **Total Deaths in Each State**

```{r echo = FALSE}
library(dplyr)
library(ggplot2)

death_totals <- data %>% 
  select(State, Deaths, Cause.Name) %>%
  filter(State != 'United States', Cause.Name != 'All causes') %>%
  group_by(State) %>%
  summarize(Total_Deaths = sum(Deaths, na.rm = TRUE))


# Highlighting California since it has the most deaths
death_totals <- death_totals %>%
  mutate(Color = ifelse(State == "California", "California", "Other"))

TOTAL_DEATHS_BY_STATE <- ggplot(death_totals, aes(x = Total_Deaths, y = reorder(State, Total_Deaths), fill = Color)) +
  geom_col() +
  scale_fill_manual(values = c("California" = "red")) +
  labs(
    x = "Deaths",
    y = "States",
    title = "Total Amount of Deaths in Each State Since 2001"
  ) +
  theme_minimal() +
  theme(legend.position = "none") 

print(TOTAL_DEATHS_BY_STATE)
```

---

## **Leading Cause of Deaths in California **

```{r echo=FALSE}
Leading_cause <- data %>%
  filter(State == 'California', Cause.Name != 'All causes') %>%
  group_by(Cause.Name) %>%
  summarize(sum(Deaths)) %>%
  ggplot(aes(x = Cause.Name, y = `sum(Deaths)`)) + geom_col(fill = 'violet', color = 'black') +
  labs(
    title = "Leading Causes of Death in California",
    x = "Cause Name",
    y = "Total Number of Deaths"
  ) +
  theme_minimal() +
  scale_x_discrete(guide = guide_axis( angle = 80))

Leading_cause
```

---

## **How has the number of heart disease deaths changed over time?**

```{r echo = FALSE, warning=FALSE, message=FALSE}
library(kableExtra)

# Filtering the heart disease data
heart_data <- subset(data, grepl("Heart disease", Cause.Name, ignore.case = TRUE))

# Number of heart disease deaths each year since 1999
heart_trend <- heart_data %>%
  group_by(Year) %>%
  summarise(Total_Heart_Deaths = sum(Deaths, na.rm = TRUE))

heart_trend %>%
  mutate(Total_Heart_Deaths = format(Total_Heart_Deaths, big.mark = ",")) %>%
  kable(col.names = c("Year", "Total Deaths")) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "bordered"),
    full_width = FALSE,
    position = "left"
  ) %>%
  column_spec(1, width = "4cm", bold = TRUE) %>%
  column_spec(2, width = "4cm")        

# Number of heart disease deaths each year since 2001
HEART_DISEASE <- data %>% 
  filter(Cause.Name == 'Heart disease', State == 'California') %>%
  group_by(Year) %>%
  summarize(TOTAL = sum(Deaths)) %>%
  
  # Plotting the rate of heart disease deaths over time
  ggplot(aes(x = Year, y = TOTAL)) + 
  geom_line(color = 'lightblue', linewidth = 1.2) + 
  geom_point(color = 'black') +
  labs(
    title = "Total Heart Disease Deaths",
    x = "Year",
    y = "Total number of Heart Disease Deaths"
  ) +
  theme_minimal()

HEART_DISEASE
```

---

## **How has the number of cancer deaths changed over time?**

```{r echo = FALSE, warning=FALSE, message=FALSE}
library(knitr)
library(kableExtra)

# Filtering the cancer data
cancer_data <- subset(data, grepl("cancer", Cause.Name, ignore.case = TRUE))

# Number of cancer deaths each year since 2001
cancer_trend <- cancer_data %>%
  group_by(Year) %>%
  summarise(Total_Deaths = sum(Deaths))

library(kableExtra)

cancer_trend %>%
  mutate(Total_Deaths = format(Total_Deaths, big.mark = ",")) %>%
  kable(col.names = c("Year", "Total Deaths")) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "bordered"),
    full_width = FALSE,
    position = "left"
  ) %>%
  column_spec(1, width = "4cm", bold = TRUE) %>%
  column_spec(2, width = "4cm")                 

# Plotting the rate of cancer deaths over time
library(ggplot2)
ggplot(cancer_trend, aes(x = Year, y = Total_Deaths)) +
  geom_line(color = "aquamarine3", linewidth = 1.2) +
  geom_point(color = "black") +
  labs(title = "Trend of Cancer Deaths Over Time",
       x = "Year",
       y = "Total Cancer Deaths") +
  theme_minimal()
```

---

```{r echo = FALSE}
#HIGHER PERCENTAGE = SUGGESTS AN OLDER POPULATION

PERCENTAGE <- data %>%
  select(Age.adjusted.Death.Rate,Cause.Name, State) %>%
  filter(Cause.Name != 'All causes') %>%
  ggplot(aes( y = Cause.Name, x = Age.adjusted.Death.Rate, color = Cause.Name)) + geom_point(alpha = .5) +
  labs(
    title = "Age-Adjusted Death Rates by Cause",
    x = "Age Adjusted Death Rate",
    y = "Causes"
  )
PERCENTAGE

HEART <- data %>% select(Year, State, Age.adjusted.Death.Rate) %>%
  filter(State != 'United States') %>%
  ggplot(aes(y = State, x = Age.adjusted.Death.Rate, color = Year)) + geom_point() +
  labs(
    title = "Heart Disease Death Rates Across States",
    x = "Age Adjusted Death Rate",
    y = "State"
  )
HEART

#AVERAGE DEATHS BY EACH STATE 

AVG <-  data %>%
  filter(Cause.Name == 'All causes', State != 'United States', Year == 2002) %>%
  group_by(State) %>%
  summarize(AVG = (Deaths/100000) * 100)
AVG 

```
  
---

# We know the adjusted death rate for the data, but what does the rate look like when we subtract "all causes'?

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
library(patchwork)

all_causes <- data %>%
  filter(Cause.Name == "All causes") %>%
  select(State, Year, TotalDeaths = Deaths)

known_cause_totals <- data %>%
  filter(Cause.Name != "All causes") %>%
  group_by(State, Year) %>% 
  summarise(KnownCauseDeaths = sum(Deaths), .groups = "drop")

residual_deaths <- all_causes %>%
  left_join(known_cause_totals, by = c("State", "Year")) %>%
  mutate(UnclassifiedDeaths = TotalDeaths - KnownCauseDeaths)


residual_deaths %>%
  mutate(
    UnclassifiedDeaths = TotalDeaths - KnownCauseDeaths,
    across(c(TotalDeaths, KnownCauseDeaths, UnclassifiedDeaths), 
           ~ format(., big.mark = ","))
  ) %>% 
  select(State, Year, TotalDeaths, KnownCauseDeaths, UnclassifiedDeaths) %>%
  head(10) %>% 
  kable(
    col.names = c("State", "Year", "Total Deaths", "Explained Deaths", "Unexplained Deaths"),
    align = c("l", "c", "r", "r", "r")
  ) %>% 
  kable_styling(
    bootstrap_options = c("striped", "hover", "bordered"),
    full_width = FALSE,
    position = "left"
  ) %>%
  column_spec(1, width = "3cm", bold = TRUE) %>%
  column_spec(2, width = "2cm") %>%
  column_spec(3:5, width = "3cm")
      


# Plot 1: Deaths by known causes
plot1 <- data %>% 
  filter(State != "United States", Cause.Name != "All causes") %>% 
  ggplot(aes(x = Year, y = Deaths, fill = Cause.Name)) +
  geom_col(position = "stack") +
  labs(
    title = "Deaths by Cause and Year in U.S. States",
    x = "Year",
    y = "Deaths",
    fill = "Cause of Death"
  ) +
  theme_minimal() +
  scale_x_discrete(guide = guide_axis(angle = 80)) +
  theme(legend.position = "bottom") +
  guides(fill = guide_legend(nrow = 2))  

# Plot 2: Unexplained deaths
plot2 <- residual_deaths %>% 
  filter(State != "United States") %>% 
  ggplot(aes(x = Year, y = UnclassifiedDeaths, fill = State)) +
  geom_col(position = "stack") +
  labs(
    title = "Unexplained Deaths",
    x = "Year",
    y = "Deaths",
    fill = "State"
  ) +
  theme_minimal() +
  scale_x_discrete(guide = guide_axis(angle = 80)) +
  theme(legend.position = "none")  

combined <- (plot1 + plot2) +
  plot_layout(ncol = 2)

final_plot <- combined + plot_annotation(tag_levels = 'A')
final_plot
```

---

## **What is age adjusted death rate?**
- Different states or regions have different age structures (e.g., Florida has more older people). 
Older populations naturally have higher death rates so comparing raw death rates across states would be misleading.

- To make fair comparisons across the states, public health stats use age adjustment 

- Instead of comparing raw numbers, we adjust both using the same "standard" population age structure, usually the U.S. standard population.

- A higher rate could suggest a higher proportion of older individuals in the population.

---

# What is the death rate by cause and state?

```{r echo = FALSE, warning=FALSE, message=FALSE}
library(plotly)
p <- data %>%   filter(State !="United States", Cause.Name != "All causes") %>% 
  group_by(State, Cause.Name) %>% summarise(RatebyState = mean(Age.adjusted.Death.Rate)) %>% 
  ggplot(aes(y = Cause.Name, x = RatebyState, color = Cause.Name, text = State)) + geom_jitter() +
  labs(title = "Death Rate by Cause and State",
       x = "Average Age-Adjusted Death Rate",
       y = "Cause of Death") +
  theme_minimal()
ggplotly(p)
```

---

```{r echo=FALSE}
library(dplyr)
library(ggplot2)

heart_disease_data <- data %>%
  filter(Cause.Name == "Heart disease")

ggplot(heart_disease_data, aes(x = as.factor(Year), y = reorder(State, -Age.adjusted.Death.Rate), fill = Age.adjusted.Death.Rate)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c(option = "plasma", name = "Death Rate") +
  labs(
    title = "Heatmap: Age-Adjusted Death Rate for Heart Disease",
    x = "Year",
    y = "State"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.grid = element_blank()
  )

```



